# RCB TARGET ARCHITECTURE â€” FINAL
## The Method Leads. AI Participates. The User Gets Clarity.
## Date: February 17, 2026
## For: Claude Code â€” Review against codebase, then implement block by block

---

## CORE PRINCIPLE

The Israeli customs classification methodology (Phases 0-9) is the **backbone**.
AI is woven into every phase as an **active participant** â€” reads, researches,
challenges, enriches, plays devil's advocate. The method has the final say.

When the method + AI reach 100% certainty â†’ deliver the answer.
When they don't â†’ ask the user a **precise, structured question** that will
resolve it. Process the answer. Reach 100%. This is how professional accuracy
becomes achievable on every single classification.

**The final product delivers**: Accuracy, professionalism, comfort, visuality,
clear language, accumulated knowledge, saved searches and actions, helpful
reminders, and flagged crucial points.

---

## THE PRODUCT EXPERIENCE â€” WHAT THE USER SEES

### Principle: Tables First. Short and Precise. Elaboration Second.

The user is a busy customs broker or operations person. They want:
1. **The answer** â€” in a clear table, Hebrew, professional
2. **What they need to do** â€” flagged, highlighted
3. **Why** â€” only if they scroll down to read more

Every email from RCB follows this structure:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECTION 1: THE ANSWER (always present)                 â”‚
â”‚                                                         â”‚
â”‚  Clean table(s) with:                                   â”‚
â”‚  - HS code(s)                                           â”‚
â”‚  - Hebrew tariff description (exact from ×ª×¢×¨×™×£)         â”‚
â”‚  - Duty rate, purchase tax                              â”‚
â”‚  - Import requirements (licenses, standards)            â”‚
â”‚  - Status indicators (âœ“ confirmed / âš  needs input)     â”‚
â”‚  - Crucial flags (âš  requires permit! âš  antidumping!)   â”‚
â”‚                                                         â”‚
â”‚  If clarification needed: the question box (see below)  â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SECTION 2: ELABORATION (for those who want detail)     â”‚
â”‚                                                         â”‚
â”‚  - Why this code (elimination reasoning, brief)         â”‚
â”‚  - Sources consulted                                    â”‚
â”‚  - Alternative codes considered and why eliminated       â”‚
â”‚  - Any AI disagreements and how resolved                â”‚
â”‚  - Confidence breakdown                                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### When 100% Certain â€” The Classification Report

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  RCB â€” ×“×•×— ×¡×™×•×•×’                                        â•‘
â•‘  Invoice: [supplier] #[number] | Date: [date]           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ ×©×•×¨×” â”‚ ×¤×¨×˜ ××›×¡     â”‚ ×ª×™××•×¨ ×ª×¢×¨×™×£       â”‚ ××›×¡  â”‚ ××¡   â”‚ â•‘
â•‘  â”‚ Line â”‚ HS Code     â”‚ Tariff Desc (HE)  â”‚ Duty â”‚ Tax  â”‚ â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘  â”‚  1   â”‚73.26.9000/2â”‚ ××•×¦×¨×™× ××—×¨×™× ×©×œ    â”‚ 6%  â”‚ 17% â”‚ â•‘
â•‘  â”‚      â”‚            â”‚ ×‘×¨×–×œ ××• ×¤×œ×“×”       â”‚      â”‚      â”‚ â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘  â”‚  2   â”‚39.23.1000/8â”‚ ×§×•×¤×¡××•×ª, ××¨×’×–×™×    â”‚ 12% â”‚ 17% â”‚ â•‘
â•‘  â”‚      â”‚            â”‚ ×•×›×œ×™ ×§×™×‘×•×œ ×“×•××™×   â”‚      â”‚      â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                          â•‘
â•‘  âš  ×©×•×¨×” 2: ×“×¨×•×© ××™×©×•×¨ ××›×•×Ÿ ×”×ª×§× ×™× ×”×™×©×¨××œ×™ (××ª"×™)         â•‘
â•‘  âš  Line 2: Requires Standards Institute approval          â•‘
â•‘                                                          â•‘
â•‘  âœ“ ×‘×“×™×§×ª ×¦×• ×™×‘×•× ×—×•×¤×©×™ â€” ×ª×§×™×Ÿ                            â•‘
â•‘  âœ“ Free Import Order check â€” passed                      â•‘
â•‘                                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ELABORATION (click to expand / scroll down)             â•‘
â•‘  ...reasoning, sources, alternatives considered...       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### When Clarification Needed â€” The Smart Question

This is the KEY feature that achieves 100% accuracy. When the system has done
all its work (Phases 0-8) but can't reach certainty on an item:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  RCB â€” ×“×•×— ×¡×™×•×•×’ (×“×¨×•×© ×”×‘×”×¨×”)                           â•‘
â•‘  Invoice: Goodpack #GP-2026-0441 | Date: 2026-02-17     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                          â•‘
â•‘  âœ“ ×©×•×¨×” 1: 84.31.3100/4 â€” ×¡×™×•×•×’ ×××•×©×¨                   â•‘
â•‘    (×—×œ×§×™× ×©×œ ××›×•× ×•×ª ×”×¨××” â€” âœ“ confirmed)                   â•‘
â•‘                                                          â•‘
â•‘  âš  ×©×•×¨×” 3: ×“×¨×•×©×” ×”×‘×”×¨×”                                  â•‘
â•‘                                                          â•‘
â•‘  Invoice line 3: "Empty metal boxes"                     â•‘
â•‘  Supplier: Goodpack | Item: GP-IBC-1220                  â•‘
â•‘                                                          â•‘
â•‘  ×”××¢×¨×›×ª ×‘×“×§×” ×•×¡×™×•×•×’×” â€” ×©× ×™ ×¤×¨×˜×™ ××›×¡ ××¤×©×¨×™×™×:              â•‘
â•‘  (System checked â€” two possible classifications:)        â•‘
â•‘                                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚  #  â”‚ ×¤×¨×˜ ××›×¡     â”‚ ×ª×™××•×¨ ××ª×¢×¨×™×£ ×”××›×¡         â”‚ ××›×¡  â”‚ â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘  â”‚  ×  â”‚73.26.9000/2â”‚ ××•×¦×¨×™× ××—×¨×™× ×©×œ ×‘×¨×–×œ      â”‚  6% â”‚ â•‘
â•‘  â”‚     â”‚            â”‚ ××• ×¤×œ×“×”, ×œ× × ×ª×¤×¡×™×        â”‚      â”‚ â•‘
â•‘  â”‚     â”‚            â”‚ ×‘×¤×¨×˜ ××—×¨ ×‘×¤×¨×§ ×–×”          â”‚      â”‚ â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤ â•‘
â•‘  â”‚  ×‘  â”‚73.10.1000/6â”‚ ××™×›×œ×™×, ×—×‘×™×•×ª, ×¤×—×™×       â”‚  8% â”‚ â•‘
â•‘  â”‚     â”‚            â”‚ ×•×›×œ×™ ×§×™×‘×•×œ ×“×•××™× ×©×œ        â”‚      â”‚ â•‘
â•‘  â”‚     â”‚            â”‚ ×‘×¨×–×œ ××• ×¤×œ×“×”              â”‚      â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                                          â•‘
â•‘  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â•‘
â•‘  â•‘  ×œ×¦×•×¨×š ×¡×™×•×•×’ ××“×•×™×§, × × ×”×‘×”×™×¨×•:                    â•‘  â•‘
â•‘  â•‘  (To classify precisely, please clarify:)          â•‘  â•‘
â•‘  â•‘                                                    â•‘  â•‘
â•‘  â•‘  1. ×”×× ×”×§×•×¤×¡××•×ª × ×¡×’×¨×•×ª ×”×¨××˜×™×ª?                    â•‘  â•‘
â•‘  â•‘     (Do the boxes close hermetically?)             â•‘  â•‘
â•‘  â•‘                                                    â•‘  â•‘
â•‘  â•‘     [ ] ×›×Ÿ, × ×¡×’×¨×•×ª ×”×¨××˜×™×ª (Yes, hermetically)     â•‘  â•‘
â•‘  â•‘     [ ] ×œ×, ×¤×ª×•×—×•×ª/××ª×§×¤×œ×•×ª (No, open/foldable)    â•‘  â•‘
â•‘  â•‘                                                    â•‘  â•‘
â•‘  â•‘  2. ××” ×”× ×¤×—? (What is the volume?)                 â•‘  â•‘
â•‘  â•‘                                                    â•‘  â•‘
â•‘  â•‘     [ ] ××¢×œ 300 ×œ×™×˜×¨ (Over 300L)                   â•‘  â•‘
â•‘  â•‘     [ ] ××ª×—×ª 300 ×œ×™×˜×¨ (Under 300L)                 â•‘  â•‘
â•‘  â•‘                                                    â•‘  â•‘
â•‘  â•‘  ×”×¢×¨×•×ª × ×•×¡×¤×•×ª: ______________________________      â•‘  â•‘
â•‘  â•‘  (Additional notes)                                â•‘  â•‘
â•‘  â•‘                                                    â•‘  â•‘
â•‘  â•‘              [ ×”×©×‘ / Reply ]                       â•‘  â•‘
â•‘  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â•‘
â•‘                                                          â•‘
â•‘  ğŸ’¡ ×× ×”×§×•×¤×¡××•×ª ×¤×ª×•×—×•×ª/××ª×§×¤×œ×•×ª ×•××ª×—×ª 300L:              â•‘
â•‘     â†’ 73.26.9000/2 (××•×¦×¨×™× ××—×¨×™×) â€” ××›×¡ 6%             â•‘
â•‘     ×× ×”×§×•×¤×¡××•×ª × ×¡×’×¨×•×ª ×”×¨××˜×™×ª ×•××¢×œ 300L:                â•‘
â•‘     â†’ 73.10.1000/6 (××™×›×œ×™×) â€” ××›×¡ 8%                    â•‘
â•‘                                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ELABORATION                                             â•‘
â•‘  ...why these two codes, what was eliminated, sources... â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### The Reply Processing Loop

When the user replies (clicks options + optional notes):

```
User replies: "×œ×, ×¤×ª×•×—×•×ª/××ª×§×¤×œ×•×ª" + "××ª×—×ª 300 ×œ×™×˜×¨"
    â”‚
    â–¼
System receives reply via email
    â”‚
    â–¼
Brain processes:
  - Match reply to original question context
  - Answer resolves the ambiguity: open/foldable + under 300L
  - Re-run ONLY the unresolved elimination step (not full pipeline)
  - 7310 eliminated (requires hermetic closure or >300L)
  - 7326.90 confirmed
    â”‚
    â–¼
Cost of processing reply: ~$0.005 (minimal AI, targeted re-evaluation)
    â”‚
    â–¼
Send FINAL classification:
  "×©×•×¨×” 3: 73.26.9000/2 â€” âœ“ ×××•×©×¨ (×‘×”×ª×× ×œ×”×‘×”×¨×” ×©×”×ª×§×‘×œ×”)"
  (Line 3: 73.26.9000/2 â€” âœ“ confirmed per clarification received)
    â”‚
    â–¼
Save to classification_memory:
  - Product: "Goodpack GP-IBC-1220, foldable steel boxes, open, <300L"
  - HS: 7326.90.9000/2
  - Confidence: 1.00 (clarification-verified)
  - Key learning: "foldable metal boxes from Goodpack = 7326.90,
    distinguish from 7310 by: not hermetic, under 300L"
  - Next time Goodpack metal boxes arrive â†’ instant classification
```

### Cost Impact of Clarification Flow

The clarification question itself costs almost nothing to generate (it comes from
the elimination log â€” the system already knows WHY it's uncertain). Processing the
reply is a tiny targeted re-evaluation, not a full pipeline run.

But the VALUE is enormous:
- Turns a "maybe 90% confident" into "100% confirmed"
- The confirmed answer goes into memory as high-confidence
- Next time â†’ instant classification, zero cost
- Reduces the "long tail" of uncertain products much faster

---

## EMAIL COMMUNICATION â€” CURRENT PROBLEM AND FIX

### Current State: Brain Can't Communicate Well

The audit found that email output is broken or poor:
- Tracker emails crash (function signature mismatch â€” fixed locally, not deployed)
- Classification reports are generic and unhelpful
- No structured clarification mechanism
- No professional formatting
- No Hebrew RTL proper rendering
- No distinction between "answer" and "elaboration"

### Target: Professional, Clear, Bilingual Communication

Every email from RCB must be:

| Requirement | Description |
|-------------|------------|
| **Table-first** | Key information in clean tables at the top, always |
| **Short and precise** | Section 1 answers the question in minimal words |
| **Hebrew RTL** | Proper right-to-left rendering with correct fonts |
| **Bilingual where needed** | Hebrew primary, English in parentheses for product descriptions |
| **Visually clear** | Status indicators (âœ“ âš ), color coding, clean borders |
| **Actionable** | If user needs to do something â†’ highlighted, specific |
| **Flagged** | Crucial points (permits, deadlines, antidumping) â†’ prominent warning |
| **Interactive** | Clarification questions with clickable options + notes field |
| **Elaboration separate** | Detail available but not forced on the user |

### Email Types and Their Format

| Email Type | Section 1 (Top) | Section 2 (Below) |
|------------|----------------|-------------------|
| **Classification â€” certain** | Table: line items, HS codes, duties, flags | Elimination reasoning, sources, alternatives considered |
| **Classification â€” needs clarification** | Table of candidates + structured question box | Why these candidates, what was eliminated |
| **Clarification reply processed** | Updated table with confirmed codes | What changed, what the answer resolved |
| **Tracker update** | Table: container/BL, status, vessel, ETA, location | Full timeline, document history |
| **Tracker alert** | âš  What happened, what user should do | Background details |
| **Daily digest** | Summary table: active deals, pending items, overdue | Per-deal detail |
| **Reminder/flag** | âš  What's due, deadline, required action | Context and background |

---

## ARCHITECTURE OVERVIEW

```
Email arrives (CC / direct / airpaport@gmail)
      â”‚
      â”œâ”€â”€ CC email â”€â”€â–º Silent learning + detect classifiable content
      â”‚                If invoice found â†’ ALSO trigger classification
      â”œâ”€â”€ airpaport â”€â”€â–º Extract verified declaration â†’ ground truth
      â”œâ”€â”€ Reply to clarification â”€â”€â–º Process answer â†’ finalize â†’ 100%
      â””â”€â”€ Direct classification request â”€â”€â–º Full pipeline
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  CHECK MEMORY FIRST                                       â•‘
â•‘  1. Exact match (past classification or declaration)?     â•‘
â•‘  2. Similar product from CC learning?                     â•‘
â•‘  3. Pre-ruling in brain knowledge base?                   â•‘
â•‘  4. Classification directive covers this?                 â•‘
â•‘  â†’ High confidence: verify + deliver ($0.00)              â•‘
â•‘  â†’ Partial match: abbreviated run from narrowed chapters  â•‘
â•‘  â†’ No match: full Phase 0-9                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PHASE 0 â€” CASE TYPE                                     â•‘
â•‘  Code: Import/Export? Movement type? Procedure?           â•‘
â•‘  AI: Resolve ambiguity from email context if needed       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PHASE 1 â€” EXAMINE GOODS (THREE PILLARS)                 â•‘
â•‘  AI: Read docs, extract material/form/weight/essence/use  â•‘
â•‘  AI: Flag inconsistencies, enrich from brain knowledge    â•‘
â•‘  Code: Validate three pillars populated                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PHASE 2 â€” GATHER INFORMATION                            â•‘
â•‘  AI: Research supplier, web search, foreign tariffs       â•‘
â•‘  Brain: Provide indexed directives, rulings, UK tariff    â•‘
â•‘  Code: Track legal obligation met (×‘×³ mandatory)         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PHASE 3 â€” ELIMINATION ENGINE                            â•‘
â•‘  Code: Walk tariff tree chapter by chapter                â•‘
â•‘  Brain: Provide chapter notes, framework definitions      â•‘
â•‘  AI: Confirm/challenge at each decision point             â•‘
â•‘  AI: Devil's advocate before finalizing                   â•‘
â•‘  Method: Decides, logs reasoning including AI input       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PHASE 4 â€” BILINGUAL VERIFICATION                        â•‘
â•‘  Code: Query shaarolami HE + EN, compare                  â•‘
â•‘  AI: Analyze mismatches if any                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PHASE 5 â€” POST-CLASSIFICATION VERIFICATION              â•‘
â•‘  Brain: Matching directives, pre-rulings, court decisions â•‘
â•‘  AI: "Does this ruling apply to our product?"             â•‘
â•‘  Method: Accept, flag, or re-run                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PHASE 6 â€” REGULATORY & COMMERCIAL                       â•‘
â•‘  Brain: Full FIO requirements per HS code                 â•‘
â•‘  Code: Invoice validation, FTA, permits                   â•‘
â•‘  AI: Flag gaps, suggest what's needed                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PHASE 7 â€” MULTI-AI CROSS-CHECK                          â•‘
â•‘  AI models classify independently (blind)                 â•‘
â•‘  Compare to method's result                               â•‘
â•‘  Disagreement: identify divergence, document both         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PHASE 8 â€” SOURCE ATTRIBUTION                            â•‘
â•‘  Code: Every decision â†’ source reference                  â•‘
â•‘  AI: Review completeness                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  DECISION POINT                                          â•‘
â•‘                                                           â•‘
â•‘  Certain (all items resolved)?                            â•‘
â•‘  â”œâ”€â”€ YES â†’ Phase 9: FINAL REPORT (table-first format)    â•‘
â•‘  â””â”€â”€ NO  â†’ Phase 9: CLARIFICATION EMAIL                  â•‘
â•‘            - Table of candidates per uncertain item       â•‘
â•‘            - Structured question with clickable options   â•‘
â•‘            - Notes field for free-text                    â•‘
â•‘            - Shows: "if X then code A, if Y then code B"  â•‘
â•‘            - User replies â†’ brain processes â†’ 100%        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      â”‚
      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ALWAYS â€” LEARN, RECORD, IMPROVE                         â•‘
â•‘  Save classification + elimination log                    â•‘
â•‘  Update indexes (keyword, product, supplier)              â•‘
â•‘  AI reflects: "What was tricky? What to remember?"        â•‘
â•‘  Clarification answers â†’ high-confidence memory entries   â•‘
â•‘  CC + airpaport learning in parallel                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## THE THREE LEARNING CHANNELS

### Channel 1: CC Emails (FREE)
- Team's actual classification work, expert-verified
- ~200-400 data points/month
- Silent: observe, extract, store. Never reply.

### Channel 2: Customs Declarations â€” airpaport@gmail.com (FREE)
- ×¨×©×•××•× ×™ ××›×¡ that customs ACCEPTED = ground truth
- ~100-200 data points/month
- HS codes, duties, requirements â€” all confirmed by customs authority

### Channel 3: Brain Knowledge Base (One-time + maintenance)

| Source | Impact |
|--------|--------|
| ×¤×§×•×“×ª ×”××›×¡ | Full legal framework â€” the rules the method follows |
| ×¦×• ×™×‘×•× ×—×•×¤×©×™ â€” ALL appendices | Per HS code: licenses, standards, ministries |
| ×¦×• ×™×¦×•× ×—×•×¤×©×™ â€” ALL appendices | Per HS code: export requirements |
| ×¦×• ×”××¡×’×¨×ª â€” complete | Legal definitions that override common language |
| ×”×¨××™×©×” ×œ×¤×¨×§ â€” all 99 chapters | Gates for Phase 3 elimination |
| ×”× ×—×™×•×ª ×¡×™×•×•×’ â€” all directives | Customs authority interpretation per code |
| ×¤×¨×”-×¨×•×œ×™× ×’ â€” all published | Official classifications for specific products |
| Court decisions | Legal precedents (VIVO, DENVER SANDALS, HALPERIN) |
| ×§×•×“×™ ×”× ×—×” ×•×ª×•×¡×¤×•×ª | FTA rates, preferential duties |
| Full shaarolami dump HE + EN | All codes with descriptions and duties |

Once indexed: thousands of classification paths pre-answered before any email arrives.

### Channel 4: Clarification Replies (VERY CHEAP)

Every clarification that gets answered becomes a HIGH-CONFIDENCE memory entry:
- The question identified exactly what was ambiguous
- The answer resolved it definitively
- The confirmed classification goes into memory with confidence â‰ˆ 1.00
- Next time this product appears â†’ instant, no question needed

**This is the fastest path from "uncertain" to "100% known"** â€” and it costs
almost nothing ($0.005 to process each reply).

---

## MODEL ROUTING

| Priority | Model | Roles | Cost/call |
|----------|-------|-------|-----------|
| 1 | **FREE** | Memory, brain knowledge, indexes, regex, templates, Firestore, shaarolami cache, elimination logic, CC/declaration extraction | $0.00 |
| 2 | **Gemini Flash** | Document extraction fallback | ~$0.001 |
| 3 | **GPT-4o** | Primary AI: read docs, research, elimination participation, devil's advocate, reports, clarification questions | ~$0.01-0.02 |
| 4 | **Claude Sonnet** | Specialist: complex legal Hebrew, disputed Rule 3, ambiguous cases | ~$0.02-0.03 |
| 5 | **Three-way** | Independent cross-check, disagreement resolution | ~$0.05-0.10 |

---

## THE KINGS ROAD â€” COST EVOLUTION

### Per-Email Cost Breakdown (After All Blocks Built)

| Scenario | What Happens | Cost |
|----------|-------------|------|
| **Memory hit â€” exact match** | Verify against current tariff, deliver | $0.002 |
| **Memory hit â€” similar product** | Abbreviated run from narrowed chapters | $0.015 |
| **Full run â€” straightforward** | Phases 0-9, method resolves cleanly | $0.04 |
| **Full run â€” needs clarification** | Phases 0-8, send question, wait for reply | $0.04 + $0.005 when reply comes |
| **Full run â€” complex** | Claude escalation, cross-check | $0.08-0.12 |

### 12-Month Projection (20 classification emails/day)

| Month | Block | Memory hit | Clarification rate | Avg $/email | Classification | Brain | **Total** | Accuracy |
|-------|-------|-----------|-------------------|-------------|---------------|-------|-----------|----------|
| 1 | A (runs) | 10-15%* | 30% (no method yet) | $0.05 | $30 | $105 | **$135** | 60-70% |
| 2 | B+C (data) | 25-35%* | 25% | $0.04 | $24 | $105 | **$129** | 75-80% |
| 3 | D (engine) | 45-55% | 15% | $0.025 | $15 | $105 | **$120** | 90%+ |
| 4 | E (verify) | 55-65% | 10% | $0.018 | $11 | $90 | **$101** | 93-95% |
| 5 | F (routing) | 65-70% | 8% | $0.014 | $8 | $80 | **$88** | 95%+ |
| 6 | G (memory) | 70-80% | 5% | $0.010 | $6 | $70 | **$76** | 97%+ |
| 9 | G mature | 85-90% | 3% | $0.006 | $4 | $45 | **$49** | 98-100% |
| 12 | Cruising | 90%+ | <2% | $0.004 | $2.50 | $30 | **$33** | 99-100% |

*Months 1-2: memory hits come from CC/airpaport + brain knowledge, not self-classification.

**Key insight**: Clarification rate DROPS as memory grows. By month 6, most products
have been seen (directly, via CC, via declarations, or via brain knowledge). The few
that need clarification get answered, stored, and never asked again.

### Year 1 Total

| Period | Months | Avg monthly | Subtotal |
|--------|--------|-------------|----------|
| Building (months 1-3) | 3 | $128 | $384 |
| Optimizing (months 4-6) | 3 | $88 | $264 |
| Cruising (months 7-12) | 6 | $41 | $246 |
| One-time brain download | â€” | â€” | $20 |
| **Year 1 total** | | | **~$914** |
| **Average monthly** | | | **~$76** |

### Year 2 Projection

| Item | Monthly |
|------|---------|
| Classification (90%+ memory, rare full runs) | $2-3 |
| Brain maintenance (monitoring for legal changes) | $15-25 |
| **Year 2 monthly** | **$17-28** |
| **Year 2 annual** | **$204-336** |

### Comparison

| Approach | Monthly avg | Annual | Accuracy |
|----------|-----------|--------|----------|
| Pure AI, no method | $200-250 | $2,400-3,000 | 60-70% (never improves) |
| **Kings Road Year 1** | **$76** | **$914** | **60% â†’ 99-100%** |
| **Kings Road Year 2** | **$22** | **$270** | **99-100%** |

---

## HELPING, REMINDING, AND FLAGGING

Beyond classification, the system proactively helps the user:

### Proactive Flags (in every relevant email)

| Flag Type | Example | When |
|-----------|---------|------|
| âš  Permit required | "âš  HS 7326.90 â€” requires ××ª"×™ approval for import >100 units" | Phase 6 check finds requirement |
| âš  Antidumping | "âš  Product from China under antidumping order #XX" | Phase 6 match against orders |
| âš  FTA opportunity | "âœ“ EUR.1 available â€” duty 0% instead of 6% from EU origin" | Phase 6 FTA check |
| âš  Deadline | "âš  D/O expires Feb 20 â€” 3 days remaining" | Tracker timeline check |
| âš  Missing document | "âš  BL received but no invoice yet for deal #XX" | Document lifecycle tracking |
| âš  Rate change | "âš  Duty rate for 7326.90 changed from 6% to 8% effective Mar 1" | Brain tariff monitoring |
| ğŸ’¡ Suggestion | "ğŸ’¡ Similar product classified as 7326.20 in pre-ruling PR-2024-XX â€” verify" | Brain knowledge match |

### Daily Digest Email

Morning summary for the operations team:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  RCB â€” ×¡×™×›×•× ×™×•××™ | February 18, 2026                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                          â•‘
â•‘  ğŸ“‹ ×¡×™×•×•×’×™× ×××ª×™× ×™× ×œ×”×‘×”×¨×”: 2                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”‚ Deal   â”‚ Product      â”‚ Waiting since    â”‚            â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â•‘
â•‘  â”‚ D-0441 â”‚ Metal boxes  â”‚ Feb 17 (1 day)   â”‚            â•‘
â•‘  â”‚ D-0439 â”‚ LED panels   â”‚ Feb 15 (3 days!) â”‚            â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                                                          â•‘
â•‘  ğŸš¢ ××¢×§×‘ ××©×œ×•×—×™×:                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”         â•‘
â•‘  â”‚ Deal   â”‚ Type   â”‚ Vessel   â”‚ ETA   â”‚ Status â”‚         â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â•‘
â•‘  â”‚ D-0440 â”‚ FCL    â”‚ MSC ANNA â”‚ Feb 19â”‚ âš  1day â”‚         â•‘
â•‘  â”‚ D-0438 â”‚ LCL    â”‚ â€”        â”‚ Feb 22â”‚ âœ“ OK   â”‚         â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â•‘
â•‘                                                          â•‘
â•‘  âš  D-0435: D/O expires tomorrow!                        â•‘
â•‘  âš  D-0439: Clarification pending 3 days â€” follow up     â•‘
â•‘                                                          â•‘
â•‘  ğŸ“Š Yesterday: 18 emails processed, 12 classified,       â•‘
â•‘     4 learned from CC, 2 pending clarification           â•‘
â•‘                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Knowledge Accumulation Tracking

The system tracks and reports its own growth:

```
ğŸ“Š Brain Status (monthly):
  Knowledge base: 11,753 tariff codes indexed
  Chapter notes: 99/99 complete
  Classifications in memory: 3,847
  Verified by customs: 1,234
  Expert-verified (CC): 2,103
  Self-classified: 510
  Suppliers known: 89
  Products known: 2,456
  Average classification time: 12 seconds
  Memory hit rate: 78%
  Clarification rate: 4%
  Accuracy (verified): 99.2%
```

---

## IMPLEMENTATION ROADMAP â€” SEQUENTIAL

**Claude Code: review against codebase, answer review questions, THEN implement.**

### Block A: Make It Run (NOW)

| Step | What |
|------|------|
| A1 | CC emails with invoices â†’ trigger classification alongside CC learning |
| A2 | airpaport@gmail.com â†’ extract declarations to ground truth memory |
| A3 | Clarification reply processing â€” detect reply to RCB question, extract answers |
| A4 | Never "unclassifiable" â€” always present candidates with structured question |
| A5 | Unstick 9 pending emails |
| A6 | Fix email output format â€” table-first, short, professional |
| A7 | Deploy to Firebase |

### Block B: Make It Read (THIS WEEK)

| Step | What |
|------|------|
| B1 | Wire smart_extractor into classification path |
| B2 | Broaden keyword_index |
| B3 | Add fuzzy/semantic search fallback |

### Block C: Make It Know (THIS WEEK)

| Step | What |
|------|------|
| C1 | Clean tariff data (35.7% garbage, ch40/64 swap) |
| C2 | Brain downloads: ×”×¨××™×©×” ×œ×¤×¨×§ (all 99 chapters) |
| C3 | Brain downloads: ×¦×• ×™×‘×•× ×—×•×¤×©×™ â€” ALL appendices |
| C4 | Brain downloads: ×¦×• ×™×¦×•× ×—×•×¤×©×™ â€” ALL appendices |
| C5 | Brain downloads: ×¦×• ×”××¡×’×¨×ª â€” complete |
| C6 | Brain downloads: ×”× ×—×™×•×ª ×¡×™×•×•×’ (all directives) |
| C7 | Brain downloads: ×¤×¨×”-×¨×•×œ×™× ×’ database |
| C8 | Fill blank tariff descriptions + duty rates from shaarolami |

### Block D: Elimination Engine (NEXT)

| Step | What |
|------|------|
| D1 | elimination_engine.py â€” core tree-walking logic |
| D2 | Chapter elimination using brain's chapter notes |
| D3 | Heading elimination â€” specific to general |
| D4 | Rule 3 (×›×œ×œ 3) â€” 3×, 3×‘, 3×’ |
| D5 | "××—×¨×™×" gate + "×‘××•×¤×Ÿ ×¢×™×§×¨×™" test |
| D6 | AI consultation hooks at decision points |
| D7 | Devil's advocate before finalization |
| D8 | Elimination logging for Phase 8 |
| D9 | Wire into pipeline â€” method-first, AI-assist |

### Block E: Verification (Phases 4-6)

| Step | What |
|------|------|
| E1 | Shaarolami scraper (HE + EN) |
| E2 | Phase 4 bilingual cross-check |
| E3 | Phase 5 post-verification using brain knowledge |
| E4 | Phase 6 regulatory using downloaded FIO data |
| E5 | Proactive flagging (permits, antidumping, FTA, deadlines) |

### Block F: Model Routing (Phase 7)

| Step | What |
|------|------|
| F1 | GPT-4o primary, Claude escalation |
| F2 | Phase 7 independent cross-check |
| F3 | Disagreement protocol with ground truth lookup |

### Block G: Memory & Intelligence

| Step | What |
|------|------|
| G1 | Classification memory write-back (all channels) |
| G2 | Memory search at pipeline start |
| G3 | Auto-populate indexes from every classification |
| G4 | Clarification reply â†’ high-confidence memory entry |
| G5 | AI reflection ("what was tricky?") |
| G6 | Confidence decay for old entries |
| G7 | Monthly self-critique (review against new rulings) |
| G8 | Knowledge accumulation dashboard |

### Block H: Communication Excellence

| Step | What |
|------|------|
| H1 | Table-first email templates (classification, tracker, digest) |
| H2 | Structured clarification questions with clickable options |
| H3 | Reply processing pipeline |
| H4 | Daily digest email |
| H5 | Proactive reminders and flags |
| H6 | Monthly brain status report |
| H7 | Hebrew RTL professional formatting |
| H8 | Bilingual output (Hebrew primary, English support) |

---

## SAFETY RULES

1. **One step at a time.** Complete and test before next.
2. **Never remove working code** â€” add alongside, switch when tested.
3. **Method has final say** â€” AI enriches, challenges, but doesn't override.
4. **AI disagreements ALWAYS logged** â€” alternative documented even when overridden.
5. **Blocks B+C before D** â€” engine needs clean data.
6. **Memory never auto-trusts 100%** â€” verify against current tariff.
7. **Ground truth (declarations) = high confidence (0.85, not 0.99)** â€” method must still verify. Customs accepts wrong codes (e.g. Goodpack steel boxes classified as 8609.0090 instead of Ch.73).
8. **CC learning is silent** â€” never reply, never interfere.
9. **Clarification questions are SPECIFIC** â€” never "need more info," always structured.
10. **Tables first, elaboration second** â€” in every email.
11. **Flag crucial points prominently** â€” permits, deadlines, rate changes.
12. **Test with real emails** after every block.
13. **Deploy only from main** â€” feature branches merge when tested.

---

## REVIEW QUESTIONS FOR CLAUDE CODE

Before implementing, verify against actual codebase:

1. **Routing logic**: Where does CC vs classification diverge in main.py? (Block A)
2. **airpaport@gmail.com**: Connected via Graph API? Separate polling? How? (Block A)
3. **smart_extractor.py**: What does it do? Ready to wire? (Block B)
4. **keyword_index**: What's in it? What categories missing? (Block B)
5. **Tariff data state**: Verify 35.7% garbage, chapter swap (Block C)
6. **Legal sources in Firestore**: Any chapter notes, FIO, directives already? (Block C)
7. **Email templates**: What does the current report email look like? What generates it? (Block H)
8. **Reply processing**: Any mechanism to detect replies to RCB emails? (Block A)
9. **tool_calling_engine.py**: Multi-model hooks? Current routing? (Block F)
10. **classification_memory structures**: product_index, supplier_index â€” usable? (Block G)
11. **cross_checker.py**: Wired? Working? (Block F)
12. **overnight brain**: 9 streams â€” what are they, what do they cost? (Block C)
13. **Dead code modules**: What can be wired in before writing new? (all blocks)
14. **CC + airpaport volume**: Actual email counts for learning rate validation (cost model)
15. **×¨×©×•××•×Ÿ ××›×¡ parsing**: Can system parse declaration format? (Block A/G)
16. **Email sending**: What library/method? HTML support? RTL? Tables? (Block H)

Provide assessment and suggest adjustments based on codebase reality.

---

## SUMMARY

**The product**: A customs classification system that is accurate, professional,
comfortable to use, visually clear, bilingual, knowledge-accumulating, proactively
helpful, and cost-efficient.

**The method**: Walks the tariff tree deterministically.
**AI**: Participates at every step â€” reads, researches, challenges, verifies, writes.
**When uncertain**: Sends a precise, structured question. Processes the answer. Reaches 100%.
**Three + one learning channels**: CC emails, customs declarations, brain knowledge base,
and clarification replies â€” all feed one growing brain.

**Result**: Accuracy rises from 0% (today) to 99-100% within 6 months.
Cost drops from $135/month to $33/month within 12 months.
Year 2: ~$22/month at 99-100% accuracy.

Build order: Run (A) â†’ Read (B) â†’ Know (C) â†’ Engine (D) â†’ Verify (E) â†’ Route (F)
â†’ Learn (G) â†’ Communicate (H)

Data first. Method second. AI throughout. Clarity always.
